<html><head><link rel="import" href="../bower_components/polymer/polymer.html"></head><body><dom-module id="news-data"><script>(function(){var a=document.createElement('textarea');Polymer({is:'news-data',properties:{categories:{type:Array,value:[{name:'top_stories',title:'Top Stories'},{name:'doodles',title:'Doodles'},{name:'chrome',title:'Chrome'},{name:'search',title:'Search'},{name:'shopping_payments',title:'Shopping & Payments'},{name:'nonprofits',title:'Nonprofits'}],readOnly:!0,notify:!0},categoryName:String,articleId:String,offline:Boolean,loading:{type:Boolean,readOnly:!0,notify:!0},category:{type:Object,computed:'_computeCategory(categoryName)',notify:!0},article:{type:Object,computed:'_computeArticle(category.items, articleId)',notify:!0},failure:{type:Boolean,readOnly:!0,notify:!0}},observers:['_fetchCategory(category, offline)'],_computeArticle:function(a,b){for(var c,d=0;d<a.length;++d)if(c=a[d],c.id===b)return c;return null},_computeCategory:function(a){for(var b,c=0;b=this.categories[c];++c)if(b.name===a)return b;return null},_fetchCategory:function(a,b,c){return b&&a&&a.items||!a||this.loading?void this._setFailure(!1):void this._fetch('/data/'+a.name+'.json',function(a){this.set('category.items',this._parseCategoryItems(a))}.bind(this),c||1)},_parseCategoryItems:function(a){for(var b,c=[],d=0;b=a[d];++d)c.push({headline:this._unescapeText(b.title),href:this._getItemHref(b),id:b.id,imageUrl:this._getItemImage(b),placeholder:b.placeholder,category:b.category,timeAgo:this._timeAgo(new Date(b.time).getTime()),author:b.author,summary:this._trimRight(b.summary,100),readTime:Math.max(2,Math.round(b.contentLength/3e3))+' min read'});return c},_unescapeText:function(b){return a.innerHTML=b,a.textContent},_getItemHref:function(a){return-1==a.id.lastIndexOf('www.repubblica.it')?a.id?'/article/'+this.categoryName+'/'+encodeURIComponent(a.id):null:encodeURIComponent(a.id)},_getItemImage:function(a){return-1!=a.imgSrc.lastIndexOf('www.repstatic.it')||-1!=a.imgSrc.lastIndexOf('www.gelestatic.it')?a.imgSrc:a.imgSrc?'/data/'+a.imgSrc:''},_timeAgo:function(a){var b=Math.floor;if(!a)return'';var c=(Date.now()-a)/1e3/60;if(2>c)return'1 min ago';if(60>c)return b(c)+' mins ago';if(120>c)return'1 hour ago';var d=c/60;return 24>d?b(d)+' hours ago':48>d?'1 day ago':b(d/24)+' days ago'},_trimRight:function(a,b){var c=a.indexOf(' ',b);return-1===c?a:a.substr(0,c)+'...'},_formatHTML:function(a){var b=document.createElement('template');b.innerHTML=a;for(var c,d=b.content.querySelectorAll('img'),e=0;e<d.length;++e)c=d[e],c.removeAttribute('width'),c.removeAttribute('height');return b.content.querySelector('.content').innerHTML},_fetch:function(a,b,c,d){var e=new XMLHttpRequest;e.addEventListener('load',function(a){this._setLoading(!1),d?b(a.target.responseText):b(JSON.parse(a.target.responseText))}.bind(this)),e.addEventListener('error',function(){1<c?this.debounce('_fetch',this._fetch.bind(this,a,b,c-1),200):(this._setLoading(!1),this._setFailure(!0))}.bind(this)),this._setLoading(!0),this._setFailure(!1),e.open('GET',a),e.send()},refresh:function(){this.categoryName&&this._fetchCategory(this.category,this.offline,3)}})})();</script></dom-module></body></html>